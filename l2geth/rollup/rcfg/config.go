package rcfg

import (
	"github.com/tenderly/optimism/l2geth/common/hexutil"
	"math/big"
	"os"

	"github.com/tenderly/optimism/l2geth/common"
)

// UsingBVM is used to enable or disable functionality necessary for the BVM.
var UsingBVM bool

var (
	// L2GasPriceSlot refers to the storage slot that the L2 gas price is stored
	// in in the BVM_GasPriceOracle predeploy
	L2GasPriceSlot = common.BigToHash(big.NewInt(1))
	// L1GasPriceSlot refers to the storage slot that the L1 gas price is stored
	// in in the BVM_GasPriceOracle predeploy
	L1GasPriceSlot = common.BigToHash(big.NewInt(2))
	// L2GasPriceOracleOwnerSlot refers to the storage slot that the owner of
	// the BVM_GasPriceOracle is stored in
	L2GasPriceOracleOwnerSlot = common.BigToHash(big.NewInt(0))
	// L2GasPriceOracleAddress is the address of the BVM_GasPriceOracle
	// predeploy
	L2GasPriceOracleAddress = common.HexToAddress("0x420000000000000000000000000000000000000F")
	// code Compile from commit 5721560308276eafef92e688cc03207ed2c00f53
	L2GasPriceOracleCode, _ = hexutil.Decode("0x608060405234801561001057600080fd5b50600436106101585760003560e01c8063715018a6116100c3578063de26c4a11161007c578063de26c4a114610367578063ea01cd3614610397578063f2fde38b146103b5578063f45e65d8146103d1578063fc55b138146103ef578063fe173b971461040b57610158565b8063715018a6146102cf5780638c8885c8146102d95780638da5cb5b146102f5578063bede39b514610313578063bf1fe4201461032f578063c76478321461034b57610158565b806345c51a381161011557806345c51a381461020d57806349948e0e14610229578063519b4bd31461025957806355161913146102775780635cbe497a1461029557806370465597146102b357610158565b80630c18c1621461015d5780630d1e43a01461017b5780630e6faf1e1461019957806328800578146101b7578063313ce567146101d35780633577afc5146101f1575b600080fd5b610165610429565b6040516101729190610b4f565b60405180910390f35b61018361042f565b6040516101909190610b4f565b60405180910390f35b6101a1610439565b6040516101ae9190610b4f565b60405180910390f35b6101d160048036038101906101cc9190610baa565b61043f565b005b6101db6104d8565b6040516101e89190610b4f565b60405180910390f35b61020b60048036038101906102069190610baa565b6104de565b005b61022760048036038101906102229190610baa565b610527565b005b610243600480360381019061023e9190610d1d565b610570565b6040516102509190610b4f565b60405180910390f35b6102616105d2565b60405161026e9190610b4f565b60405180910390f35b61027f6105d8565b60405161028c9190610b4f565b60405180910390f35b61029d6105de565b6040516102aa9190610b4f565b60405180910390f35b6102cd60048036038101906102c89190610baa565b6105e4565b005b6102d761062d565b005b6102f360048036038101906102ee9190610baa565b610641565b005b6102fd61068a565b60405161030a9190610da7565b60405180910390f35b61032d60048036038101906103289190610baa565b6106b3565b005b61034960048036038101906103449190610baa565b6106fc565b005b61036560048036038101906103609190610baa565b610745565b005b610381600480360381019061037c9190610d1d565b6107de565b60405161038e9190610b4f565b60405180910390f35b61039f61089d565b6040516103ac9190610da7565b60405180910390f35b6103cf60048036038101906103ca9190610dee565b6108c3565b005b6103d9610947565b6040516103e69190610b4f565b60405180910390f35b61040960048036038101906104049190610baa565b61094d565b005b6104136109e6565b6040516104209190610b4f565b60405180910390f35b60035481565b6000600654905090565b600a5481565b6104476109ec565b8060008114806104575750600181145b610496576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161048d90610e78565b60405180910390fd5b81600a819055507f65cacb453bbeab72658947058c43b2a6c7dfcca1c9d96ba1bc470d346929b288826040516104cc9190610b4f565b60405180910390a15050565b60055481565b6104e66109ec565b806003819055507f32740b35c0ea213650f60d44366b4fb211c9033b50714e4a1d34e65d5beb9bb48160405161051c9190610b4f565b60405180910390a150565b61052f6109ec565b806009819055507f5af81f5214eaf8c64101a8fde536abc770ef62af9e14d15e2b0b68760b2028f5816040516105659190610b4f565b60405180910390a150565b60008061057c836107de565b905060006002548261058e9190610ec7565b90506000600554600a6105a19190611054565b90506000600454836105b39190610ec7565b9050600082826105c391906110ce565b90508095505050505050919050565b60025481565b60075481565b60095481565b6105ec6109ec565b806004819055507f3336cd9708eaf2769a0f0dc0679f30e80f15dcd88d1921b5a16858e8b85c591a816040516106229190610b4f565b60405180910390a150565b6106356109ec565b61063f6000610a6a565b565b6106496109ec565b806005819055507fd68112a8707e326d08be3656b528c1bcc5bbbfc47f4177e2179b14d8640838c18160405161067f9190610b4f565b60405180910390a150565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b6106bb6109ec565b806002819055507f351fb23757bb5ea0546c85b7996ddd7155f96b939ebaa5ff7bc49c75f27f2c44816040516106f19190610b4f565b60405180910390a150565b6107046109ec565b806001819055507ffcdccc6074c6c42e4bd578aa9870c697dc976a270968452d2b8c8dc369fae3968160405161073a9190610b4f565b60405180910390a150565b61074d6109ec565b80600081148061075d5750600181145b61079c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161079390610e78565b60405180910390fd5b816006819055507fd1eaae13a99b475ddca546a1b4a45052c66c14049997f44a1731a8e7167981a7826040516107d29190610b4f565b60405180910390a15050565b6000806000905060005b835181101561087357600060f81b848281518110610809576108086110ff565b5b602001015160f81c60f81b7effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916141561085057600482610849919061112e565b9150610860565b60108261085d919061112e565b91505b808061086b90611184565b9150506107e8565b50600060035482610884919061112e565b905061044081610894919061112e565b92505050919050565b600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6108cb6109ec565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16141561093b576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109329061123f565b60405180910390fd5b61094481610a6a565b50565b60045481565b6109556109ec565b8060008114806109655750600181145b6109a4576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161099b90610e78565b60405180910390fd5b816007819055507f49244d4195584d0644398167ca8caa7b98ee36b674e4b4d2a2640749b27eafb7826040516109da9190610b4f565b60405180910390a15050565b60015481565b6109f4610b2e565b73ffffffffffffffffffffffffffffffffffffffff16610a1261068a565b73ffffffffffffffffffffffffffffffffffffffff1614610a68576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a5f906112ab565b60405180910390fd5b565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b600033905090565b6000819050919050565b610b4981610b36565b82525050565b6000602082019050610b646000830184610b40565b92915050565b6000604051905090565b600080fd5b600080fd5b610b8781610b36565b8114610b9257600080fd5b50565b600081359050610ba481610b7e565b92915050565b600060208284031215610bc057610bbf610b74565b5b6000610bce84828501610b95565b91505092915050565b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b610c2a82610be1565b810181811067ffffffffffffffff82111715610c4957610c48610bf2565b5b80604052505050565b6000610c5c610b6a565b9050610c688282610c21565b919050565b600067ffffffffffffffff821115610c8857610c87610bf2565b5b610c9182610be1565b9050602081019050919050565b82818337600083830152505050565b6000610cc0610cbb84610c6d565b610c52565b905082815260208101848484011115610cdc57610cdb610bdc565b5b610ce7848285610c9e565b509392505050565b600082601f830112610d0457610d03610bd7565b5b8135610d14848260208601610cad565b91505092915050565b600060208284031215610d3357610d32610b74565b5b600082013567ffffffffffffffff811115610d5157610d50610b79565b5b610d5d84828501610cef565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610d9182610d66565b9050919050565b610da181610d86565b82525050565b6000602082019050610dbc6000830184610d98565b92915050565b610dcb81610d86565b8114610dd657600080fd5b50565b600081359050610de881610dc2565b92915050565b600060208284031215610e0457610e03610b74565b5b6000610e1284828501610dd9565b91505092915050565b600082825260208201905092915050565b7f696e76616c69642076616c75652c6d7573742062652030206f72203100000000600082015250565b6000610e62601c83610e1b565b9150610e6d82610e2c565b602082019050919050565b60006020820190508181036000830152610e9181610e55565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610ed282610b36565b9150610edd83610b36565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615610f1657610f15610e98565b5b828202905092915050565b60008160011c9050919050565b6000808291508390505b6001851115610f7857808604811115610f5457610f53610e98565b5b6001851615610f635780820291505b8081029050610f7185610f21565b9450610f38565b94509492505050565b600082610f91576001905061104d565b81610f9f576000905061104d565b8160018114610fb55760028114610fbf57610fee565b600191505061104d565b60ff841115610fd157610fd0610e98565b5b8360020a915084821115610fe857610fe7610e98565b5b5061104d565b5060208310610133831016604e8410600b84101617156110235782820a90508381111561101e5761101d610e98565b5b61104d565b6110308484846001610f2e565b9250905081840481111561104757611046610e98565b5b81810290505b9392505050565b600061105f82610b36565b915061106a83610b36565b92506110977fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8484610f81565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b60006110d982610b36565b91506110e483610b36565b9250826110f4576110f361109f565b5b828204905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600061113982610b36565b915061114483610b36565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0382111561117957611178610e98565b5b828201905092915050565b600061118f82610b36565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8214156111c2576111c1610e98565b5b600182019050919050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b6000611229602683610e1b565b9150611234826111cd565b604082019050919050565b600060208201905081810360008301526112588161121c565b9050919050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b6000611295602083610e1b565b91506112a08261125f565b602082019050919050565b600060208201905081810360008301526112c481611288565b905091905056fea2646970667358221220a27df6f5432a84da559421985a625e69e24b1f6cad2c3be323fb45294f6add1864736f6c634300080b0033")
	// OverheadSlot refers to the storage slot in the BVM_GasPriceOracle that
	// holds the per transaction overhead. This is added to the L1 cost portion
	// of the fee
	OverheadSlot = common.BigToHash(big.NewInt(3))
	// ScalarSlot refers to the storage slot in the BVM_GasPriceOracle that
	// holds the transaction fee scalar. This value is scaled upwards by
	// the number of decimals
	ScalarSlot = common.BigToHash(big.NewInt(4))
	// DecimalsSlot refers to the storage slot in the BVM_GasPriceOracle that
	// holds the number of decimals in the fee scalar
	DecimalsSlot = common.BigToHash(big.NewInt(5))
	// IsBurningSlot refers to the storage slot in the BVM_GasPriceOracle that
	// holds switch controls whether GasFee is brun
	IsBurningSlot = common.BigToHash(big.NewInt(6))
	// ChargeSlot refers to the storage slot in the BVM_GasPriceOracle that
	// holds switch controls whether charge
	ChargeSlot = common.BigToHash(big.NewInt(7))
	// SccAddressSlot refers to the storage slot in the Scc contract address
	SccAddressSlot = common.BigToHash(big.NewInt(8))
	// DaGasPriceSlot refers to the storage slot that the da gas price is stored
	// in the BVM_GasPriceOracle predeploy
	DaGasPriceSlot = common.BigToHash(big.NewInt(9))
	// DaSwitchSlot refers to the storage slot in the BVM_GasPriceOracle that
	// holds switch controls whether enable DA
	DaSwitchSlot = common.BigToHash(big.NewInt(10))
)

func init() {
	UsingBVM = os.Getenv("USING_BVM") == "true"
}
